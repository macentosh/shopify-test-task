{% assign selected_collection = collections[section.settings.collection] %}
{% assign cart_product_ids = cart.items | map: 'product_id' %}

<section class="featured-products page-width page-width-desktop">
  {% if section.settings.heading != blank %}
    <h2 class="featured-products__heading">{{ section.settings.heading }}</h2>
  {% endif %}

  {% if selected_collection != blank %}
    {% assign has_products = false %}

    <div class="featured-products__grid">
      {% for product in selected_collection.products %}
        {% if cart_product_ids contains product.id %}
          {% continue %}
        {% endif %}

        {% assign has_products = true %}

        <article class="featured-products__item">
          <a href="{{ product.url }}" class="featured-products__image-link">
            {% if product.featured_image %}
              <img
                class="featured-products__image"
                src="{{ product.featured_image | image_url: width: 400 }}"
                alt="{{ product.title | escape }}"
                loading="lazy"
              >
            {% endif %}
          </a>

          <h3 class="featured-products__title">
            <a href="{{ product.url }}" class="featured-products__title-link">
              {{ product.title }}
            </a>
          </h3>

          <div class="featured-products__price">
            {{ product.price | money }}
          </div>

          {% form 'product', product, class: 'featured-products__form' %}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

            <button
              type="submit"
              class="featured-products__button"
            >
              {{ 'products.product.add_to_cart' | t | default: 'Add to cart' }}
            </button>
          {% endform %}
        </article>
      {% endfor %}
    </div>

    {% unless has_products %}
      <p class="featured-products__empty-message">
        All items from this collection are already in your cart.
      </p>
    {% endunless %}
  {% else %}
    <p class="featured-products__empty-message">
      Please select a collection in theme settings.
    </p>
  {% endif %}
</section>

{% schema %}
{
  "name": "Featured Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    }
  ],
  "presets": [
    {
      "name": "Featured (Mike)",
      "category": "Products"
    }
  ]
}
{% endschema %}